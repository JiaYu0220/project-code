import{i as C,h as f,u,a as r,s as c,d as i,e as l,g,r as w}from"./main-56a0edac.js";let d,p,y,h,m;function q(t){document.addEventListener("DOMContentLoaded",()=>{t.addEventListener("click",async e=>{if(e.target.dataset.course&&e.target.type==="button")if(C){d=e.target.dataset.course;const o=Number(e.target.dataset.quantity)||1;await j(),m=y.find(a=>a.couponId==h[0].id)!==void 0,$(o),L(),D()}else f()})})}async function j(){try{const t=`https://project-code-json.onrender.com/myCarts?userId=${u}&courseId=${d}&status=purchase`,e=`https://project-code-json.onrender.com/myCoupons?userId=${u}`,o=`https://project-code-json.onrender.com/coupons?courseId=${d}`,a=await Promise.all([r.get(t),r.get(e),r.get(o)]);p=a[0].data,y=a[1].data,h=a[2].data}catch{c("發生錯誤，請稍後再試")}}async function D(){m?i("將課程加入購物車"):(await i("將課程加入購物車"),i("首次加入購物車，獲得「體驗課優惠券」、「多堂折價優惠券」"))}function $(t){p.length?N(p[0],t):I(t)}async function I(t){try{const e={userId:u,courseId:d,quantity:t,status:"purchase",isNextPurchase:!1,dueDate:""};await r.post("https://project-code-json.onrender.com/myCarts",e,l),await g(),w()}catch{c("發生錯誤，請稍後再試")}}async function N(t,e){try{let{id:o,quantity:a,isNextPurchase:s}=t,n={};s?n={isNextPurchase:!1,quantity:e===1?a:e}:(a=Number(a)+1,n={quantity:e===1?a++:e}),await r.patch(`https://project-code-json.onrender.com/myCarts/${o}`,n,l)}catch{c("發生錯誤，請稍後再試")}}async function L(){if(!m)try{await Promise.all(h.map(t=>x(t)))}catch{c("發生錯誤，請稍後再試")}}async function x(t){try{let e=t.id,o=t.discountCourseNum*7,a=Date.now(),s=new Date(a);s.setDate(s.getDate()+o),s.setHours(23,59,59,999);let n={userId:u,couponId:e,canUse:!0,timestamp:a,dueDate:s};await r.post("https://project-code-json.onrender.com/myCoupons",n,l)}catch{c("發生錯誤，請稍後再試")}}export{q as h};
